name: Compiler test
on: [push]

jobs:
  compiler_test:
    runs-on: ubuntu-latest

    steps:
      # リポジトリをチェックアウト
      - name: Checkout
        uses: actions/checkout@v4

      # GraalVM 21をインストール
      - uses: actions/setup-java@v4
        with:
          distribution: 'graalvm'
          java-version: '21'

      # Minecraft Serverをセットアップ
      - name: Set up Minecraft Server
        run: |
          wget https://api.papermc.io/v2/projects/paper/versions/1.21.3/builds/82/downloads/paper-1.21.3-82.jar -O ~/server.jar
          (cd ~ && java -jar server.jar nogui)
          sed -i 's/false/true/g' ~/eula.txt

      #プラグイン環境のセットアップ
      - name: Set up plugin environments
        run: |
          mkdir -p ~/plugins/Skript/scripts/
          cp -r * ~/plugins/Skript/scripts/
          wget https://github.com/SkriptLang/Skript/releases/download/2.10.1/Skript-2.10.1.jar -P ~/plugins/
          wget https://github.com/ShaneBeee/SkBee/releases/download/3.8.2/SkBee-3.8.2.jar -P ~/plugins/
      
      # Minecraft Serverのランタイム検証
      - name: Run Minecraft Server for Runtime test
        run: echo "stop" | (cd ~ && java -jar server.jar nogui)
